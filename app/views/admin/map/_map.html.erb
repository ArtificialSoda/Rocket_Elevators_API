
 
    <title>Customer Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
       
     <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=#{ENV['google_api_key']}&callback=initMap&libraries=&v=weekly", defer: 'defer' %>

    <style type="text/css">
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #testmapper {
        height: 550px;
        width: 60%;


        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
          
        margin: auto;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100px;
        margin: 10px;
      }
    </style>
    <script>


var locations_from_bd = [];  // Lat & Lng
var address_place = [];      // Location of customer
var client_name = [];        // Name of client
var nb_of_batt = [];         // Number of batteries
var nb_of_coll = [];         // Number of Column
var nb_of_elev = [];         // Number of elevator
var tech_contact = [];       // Name of technical contact
var entity_of_address = [];  // Entity of address (Customer or building)

<% Address.all.each do |address| %>
  locations_from_bd.push({lat: <%= address.latitude %>, lng: <%= address.longitude %> }) // Get location in Lat and Lng in an array
  address_place.push({address_place: <%= address.number_and_street %> })  // Get address streets and number in an array (Location of Building)
  console.log('<%= address.number_and_street %>')
  entity_of_address.push({entity_of_address:<%= address.entity %>})   // Get Each Entity of address (Customer or Building)
  console.log('<%= address.entity %>')
<% end %>

<% Building.all.each do |building| %>



      let map, infoWindow;
      let lat = locations_from_bd[0].lat;
      let lng = locations_from_bd[0].lng;

      function initMap() {
        // The location of washington
        //const washington = { lat, lng };
        // The map, centered at Uluru
        map = new google.maps.Map(document.getElementById("testmapper"), {
          center: { lat, lng},
          zoom: 8,
        });
          const contentString =
            '<div id="content">' +
            '<div id="siteNotice">' +
            "</div>" +
            '<h1 id="firstHeading" class="firstHeading">Uluru</h1>' +
            '<div id="bodyContent">' +
            "<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large " +
            "sandstone rock formation in the southern part of the " +
            "Northern Territory, central Australia. It lies 335&#160;km (208&#160;mi) " +
            "south west of the nearest large town, Alice Springs; 450&#160;km " +
            "(280&#160;mi) by road. Kata Tjuta and Uluru are the two major " +
            "features of the Uluru - Kata Tjuta National Park. Uluru is " +
            "sacred to the Pitjantjatjara and Yankunytjatjara, the " +
            "Aboriginal people of the area. It has many springs, waterholes, " +
            "rock caves and ancient paintings. Uluru is listed as a World " +
            "Heritage Site.</p>" +
            '<p>Attribution: Uluru, <a href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">' +
            "https://en.wikipedia.org/w/index.php?title=Uluru</a> " +
            "(last visited June 22, 2009).</p>" +
            "</div>" +
            "</div>";
          const infowindow = new google.maps.InfoWindow({
            content: contentString,
          });
          // The marker, positioned at Uluru
          const marker = locations_from_bd.map((location, i) => {
            console.log(i);
            return new google.maps.Marker({
              position: location,
              label: i,
              map: map,
            });        
          });
          marker.addListener("click", () => {
            infowindow.open(map, marker);
          });
        } 
    </script>


<body>
    <h1>Customer Map</h1>
    <div id="testmapper"></div>
</body>



